
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="..">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.16">
    
    
      
        <title>Saga Workflow - Saga Pattern Demo with FastAPI</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-MRE9MLGXWC"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-MRE9MLGXWC",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-MRE9MLGXWC",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#saga-pattern-demo-complete-workflow" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Saga Pattern Demo with FastAPI" class="md-header__button md-logo" aria-label="Saga Pattern Demo with FastAPI" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Saga Pattern Demo with FastAPI
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Saga Workflow
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/as10896/saga-demo" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    saga-demo
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Saga Pattern Demo with FastAPI" class="md-nav__button md-logo" aria-label="Saga Pattern Demo with FastAPI" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Saga Pattern Demo with FastAPI
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/as10896/saga-demo" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    saga-demo
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Saga Workflow
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Saga Workflow
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#main-saga-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      Main Saga Workflow
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#detailed-service-interactions" class="md-nav__link">
    <span class="md-ellipsis">
      Detailed Service Interactions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#api-endpoints-and-data-flow" class="md-nav__link">
    <span class="md-ellipsis">
      API Endpoints and Data Flow
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#error-handling-and-status-transitions" class="md-nav__link">
    <span class="md-ellipsis">
      Error Handling and Status Transitions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#test-scenarios-flow" class="md-nav__link">
    <span class="md-ellipsis">
      Test Scenarios Flow
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sequence-diagram" class="md-nav__link">
    <span class="md-ellipsis">
      Sequence Diagram
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#key-features-highlighted" class="md-nav__link">
    <span class="md-ellipsis">
      Key Features Highlighted
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#main-saga-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      Main Saga Workflow
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#detailed-service-interactions" class="md-nav__link">
    <span class="md-ellipsis">
      Detailed Service Interactions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#api-endpoints-and-data-flow" class="md-nav__link">
    <span class="md-ellipsis">
      API Endpoints and Data Flow
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#error-handling-and-status-transitions" class="md-nav__link">
    <span class="md-ellipsis">
      Error Handling and Status Transitions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#test-scenarios-flow" class="md-nav__link">
    <span class="md-ellipsis">
      Test Scenarios Flow
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sequence-diagram" class="md-nav__link">
    <span class="md-ellipsis">
      Sequence Diagram
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#key-features-highlighted" class="md-nav__link">
    <span class="md-ellipsis">
      Key Features Highlighted
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
    <a href="https://github.com/as10896/saga-demo/edit/main/docs/workflow.md" title="Edit this page" class="md-content__button md-icon" rel="edit">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75z"/></svg>
    </a>
  
  


<h1 id="saga-pattern-demo-complete-workflow">Saga Pattern Demo - Complete Workflow<a class="headerlink" href="#saga-pattern-demo-complete-workflow" title="Permanent link">&para;</a></h1>
<h2 id="main-saga-workflow">Main Saga Workflow<a class="headerlink" href="#main-saga-workflow" title="Permanent link">&para;</a></h2>
<pre class="mermaid"><code>flowchart TD
    %% API Entry Point
    A[Client POST /orders] --&gt; B[Create Order Object]
    B --&gt; C[Generate Order ID &amp; Saga ID]
    C --&gt; D[Store Order in Database]

    %% Saga Orchestrator Initialization
    D --&gt; E[Saga Orchestrator: execute_saga]
    E --&gt; F[Initialize Saga Transaction]
    F --&gt; G[Set Status: PENDING]

    %% Step 1: Validate Order
    G --&gt; H[Step 1: Validate Order]
    H --&gt; I{Validation Check}
    I --&gt;|Valid| J[Mark Step: COMPLETED]
    I --&gt;|Invalid| K[Mark Step: FAILED]

    %% Step 2: Reserve Inventory
    J --&gt; L[Step 2: Reserve Inventory]
    L --&gt; M{Check Inventory}
    M --&gt;|Sufficient| N[Reduce Inventory Count]
    N --&gt; O[Mark Step: COMPLETED]
    M --&gt;|Insufficient| P[Mark Step: FAILED]

    %% Step 3: Process Payment
    O --&gt; Q[Step 3: Process Payment]
    Q --&gt; R{Check User Balance}
    R --&gt;|Sufficient| S[Deduct Amount from Balance]
    S --&gt; T[Mark Step: COMPLETED]
    R --&gt;|Insufficient| U[Mark Step: FAILED]

    %% Step 4: Ship Order
    T --&gt; V[Step 4: Ship Order]
    V --&gt; W{Shipping Check}
    W --&gt;|Success| X[Mark Step: COMPLETED]
    W --&gt;|Failure| Y[Mark Step: FAILED]

    %% Success Path
    X --&gt; Z[Set Saga Status: COMPLETED]
    Z --&gt; AA[Set Order Status: COMPLETED]
    AA --&gt; BB[Return Success Response]

    %% Failure Paths
    K --&gt; CC[Start Compensation]
    P --&gt; CC
    U --&gt; CC
    Y --&gt; CC

    %% Compensation Flow
    CC --&gt; DD[Set Saga Status: COMPENSATING]
    DD --&gt; EE[Compensate in Reverse Order]

    %% Compensation Steps
    EE --&gt; FF{Previous Steps Completed?}
    FF --&gt;|Ship Completed| GG[Step 4: Cancel Shipment]
    FF --&gt;|Payment Completed| HH[Step 3: Refund Payment]
    FF --&gt;|Inventory Completed| II[Step 2: Release Inventory]
    FF --&gt;|Validation Completed| JJ[Step 1: Mark Compensated]

    GG --&gt; KK[Log Cancellation]
    KK --&gt; LL[Mark Step: COMPENSATED]
    LL --&gt; HH

    HH --&gt; MM[Add Amount Back to Balance]
    MM --&gt; NN[Mark Step: COMPENSATED]
    NN --&gt; II

    II --&gt; OO[Add Quantity Back to Inventory]
    OO --&gt; PP[Mark Step: COMPENSATED]
    PP --&gt; JJ

    JJ --&gt; QQ[Mark Step: COMPENSATED]
    QQ --&gt; RR[Set Saga Status: FAILED]
    RR --&gt; SS[Set Order Status: FAILED]
    SS --&gt; TT[Return Error Response]

    %% Styling
    classDef success fill:#d4edda,stroke:#155724,stroke-width:2px
    classDef failure fill:#f8d7da,stroke:#721c24,stroke-width:2px
    classDef process fill:#d1ecf1,stroke:#0c5460,stroke-width:2px
    classDef decision fill:#fff3cd,stroke:#856404,stroke-width:2px
    classDef compensation fill:#f8d7da,stroke:#721c24,stroke-width:2px

    class Z,AA,BB success
    class K,P,U,Y,RR,SS,TT failure
    class B,C,D,E,F,G,H,J,L,N,O,Q,S,T,V,X process
    class I,M,R,W,FF decision
    class CC,DD,EE,GG,HH,II,JJ,KK,LL,MM,NN,OO,PP,QQ compensation</code></pre>
<h2 id="detailed-service-interactions">Detailed Service Interactions<a class="headerlink" href="#detailed-service-interactions" title="Permanent link">&para;</a></h2>
<pre class="mermaid"><code>flowchart TD
    %% Service Layer Details
    A[ValidationService] --&gt; A1[Check Quantity &gt; 0]
    A1 --&gt; A2[Check Amount &gt; 0]
    A2 --&gt; A3[Check User Exists]
    A3 --&gt; A4[Simulate Async Processing]

    B[InventoryService] --&gt; B1[Check Product Exists]
    B1 --&gt; B2[Check Sufficient Stock]
    B2 --&gt; B3[Reduce Inventory Count]
    B3 --&gt; B4[Simulate Async Processing]

    C[PaymentService] --&gt; C1[Check User Balance]
    C1 --&gt; C2[Check Sufficient Funds]
    C2 --&gt; C3[Deduct Amount]
    C3 --&gt; C4[Simulate Async Processing]

    D[ShippingService] --&gt; D1[Check Shipping Address]
    D1 --&gt; D2{User ID Check}
    D2 --&gt;|user_3| D3[Simulate Failure]
    D2 --&gt;|Other Users| D4[Process Shipment]
    D4 --&gt; D5[Simulate Async Processing]

    %% Compensation Services
    E[ValidationService.compensate] --&gt; E1[Mark as Compensated - No Action]

    F[InventoryService.compensate] --&gt; F1[Add Quantity Back]
    F1 --&gt; F2[Update Inventory DB]

    G[PaymentService.compensate] --&gt; G1[Add Amount Back]
    G1 --&gt; G2[Update User Balance]

    H[ShippingService.compensate] --&gt; H1[Cancel Shipment]
    H1 --&gt; H2[Log Cancellation]

    %% Styling
    classDef service fill:#e2e3e5,stroke:#383d41,stroke-width:2px
    classDef compensation fill:#f8d7da,stroke:#721c24,stroke-width:2px

    class A,B,C,D service
    class E,F,G,H compensation</code></pre>
<h2 id="api-endpoints-and-data-flow">API Endpoints and Data Flow<a class="headerlink" href="#api-endpoints-and-data-flow" title="Permanent link">&para;</a></h2>
<pre class="mermaid"><code>flowchart LR
    %% Client Interactions
    Client[Client Application] --&gt; POST[POST /orders]
    Client --&gt; GET_ORDER["GET /orders/{id}"]
    Client --&gt; GET_SAGA["GET /sagas/{id}"]
    Client --&gt; GET_INV[GET /inventory]
    Client --&gt; GET_BAL[GET /balances]

    %% API Processing
    POST --&gt; CreateOrder[Create Order]
    GET_ORDER --&gt; FetchOrder[Fetch Order from DB]
    GET_SAGA --&gt; FetchSaga[Fetch Saga from DB]
    GET_INV --&gt; FetchInventory[Fetch Inventory DB]
    GET_BAL --&gt; FetchBalances[Fetch User Balances]

    %% Response Flow
    CreateOrder --&gt; Response[Return Order + Saga ID]
    FetchOrder --&gt; OrderResponse[Return Order Details]
    FetchSaga --&gt; SagaResponse[Return Saga Status]
    FetchInventory --&gt; InventoryResponse[Return Inventory Levels]
    FetchBalances --&gt; BalanceResponse[Return User Balances]

    %% Database Layer
    CreateOrder --&gt; OrdersDB[(Orders Database)]
    FetchOrder --&gt; OrdersDB
    FetchSaga --&gt; SagaDB[(Saga Transactions DB)]
    FetchInventory --&gt; InventoryDB[(Inventory Database)]
    FetchBalances --&gt; UserDB[(User Balances DB)]

    %% Styling
    classDef client fill:#d1ecf1,stroke:#0c5460,stroke-width:2px
    classDef api fill:#d4edda,stroke:#155724,stroke-width:2px
    classDef db fill:#fff3cd,stroke:#856404,stroke-width:2px
    classDef response fill:#e2e3e5,stroke:#383d41,stroke-width:2px

    class Client client
    class POST,GET_ORDER,GET_SAGA,GET_INV,GET_BAL,RESET,HEALTH api
    class OrdersDB,SagaDB,InventoryDB,UserDB db
    class Response,OrderResponse,SagaResponse,InventoryResponse,BalanceResponse,ResetResponse,HealthResponse response</code></pre>
<h2 id="error-handling-and-status-transitions">Error Handling and Status Transitions<a class="headerlink" href="#error-handling-and-status-transitions" title="Permanent link">&para;</a></h2>
<pre class="mermaid"><code>stateDiagram-v2
    [*] --&gt; PENDING: Order Created

    PENDING --&gt; PROCESSING: Saga Started
    PROCESSING --&gt; COMPLETED: All Steps Success
    PROCESSING --&gt; COMPENSATING: Step Failed

    COMPENSATING --&gt; FAILED: Compensation Complete
    COMPENSATING --&gt; COMPENSATING: Continue Compensation

    COMPLETED --&gt; [*]
    FAILED --&gt; [*]

    note right of PENDING
        Initial state when order
        is first created
    end note

    note right of PROCESSING
        Saga orchestrator executing
        steps sequentially
    end note

    note right of COMPENSATING
        Executing compensation
        actions in reverse order
    end note

    note right of COMPLETED
        All steps successful,
        order fulfilled
    end note

    note right of FAILED
        Compensation complete,
        order cancelled
    end note</code></pre>
<h2 id="test-scenarios-flow">Test Scenarios Flow<a class="headerlink" href="#test-scenarios-flow" title="Permanent link">&para;</a></h2>
<pre class="mermaid"><code>flowchart TD
    %% Test Scenario 1: Success
    A1[Test 1: Valid Order] --&gt; B1[user_1, product_1, qty=2, $100]
    B1 --&gt; C1[All Steps Pass]
    C1 --&gt; D1[Order: COMPLETED]

    %% Test Scenario 2: Inventory Failure
    A2[Test 2: Insufficient Inventory] --&gt; B2[user_1, product_1, qty=200]
    B2 --&gt; C2[Inventory Step Fails]
    C2 --&gt; D2[Compensation: Validate Order]
    D2 --&gt; E2[Order: FAILED]

    %% Test Scenario 3: Payment Failure
    A3[Test 3: Insufficient Funds] --&gt; B3[user_3, product_1, qty=1, $500]
    B3 --&gt; C3[Payment Step Fails]
    C3 --&gt; D3[Compensation: Release Inventory]
    D3 --&gt; E3[Compensation: Validate Order]
    E3 --&gt; F3[Order: FAILED]

    %% Test Scenario 4: Shipping Failure
    A4[Test 4: Shipping Failure] --&gt; B4[user_3, product_1, qty=1, $50]
    B4 --&gt; C4[Shipping Step Fails]
    C4 --&gt; D4[Compensation: Refund Payment]
    D4 --&gt; E4[Compensation: Release Inventory]
    E4 --&gt; F4[Compensation: Validate Order]
    F4 --&gt; G4[Order: FAILED]

    %% Styling
    classDef success fill:#d4edda,stroke:#155724,stroke-width:2px
    classDef failure fill:#f8d7da,stroke:#721c24,stroke-width:2px
    classDef test fill:#e2e3e5,stroke:#383d41,stroke-width:2px

    class D1 success
    class E2,F3,G4 failure
    class A1,A2,A3,A4 test</code></pre>
<ul>
<li><strong>Note:</strong> To simplify the demo, we simulate the Shipping Failure by hardcoding the logic: if the order is placed by <code>user_3</code>, and both the product inventory and the user’s balance are sufficient, we intentionally force an error at the final shipping step.</li>
</ul>
<h2 id="sequence-diagram">Sequence Diagram<a class="headerlink" href="#sequence-diagram" title="Permanent link">&para;</a></h2>
<pre class="mermaid"><code>sequenceDiagram
    participant Client
    participant API
    participant Orchestrator
    participant Validation
    participant Inventory
    participant Payment
    participant Shipping

    Note over Client,API: Client initiates order creation
    Client-&gt;&gt;API: POST /orders
    Note right of API: Validate and forward order to orchestrator
    API-&gt;&gt;Orchestrator: execute_saga(order)
    Note right of Orchestrator: Start saga transaction
    Orchestrator-&gt;&gt;Validation: validate_order()
    Validation--&gt;&gt;Orchestrator: result (valid/invalid)
    alt Validation Success
        Note right of Orchestrator: Proceed to inventory reservation
        Orchestrator-&gt;&gt;Inventory: reserve_inventory()
        Inventory--&gt;&gt;Orchestrator: result (ok/fail)
        alt Inventory Success
            Note right of Orchestrator: Proceed to payment
            Orchestrator-&gt;&gt;Payment: process_payment()
            Payment--&gt;&gt;Orchestrator: result (ok/fail)
            alt Payment Success
                Note right of Orchestrator: Proceed to shipping
                Orchestrator-&gt;&gt;Shipping: ship_order()
                Shipping--&gt;&gt;Orchestrator: result (ok/fail)
                alt Shipping Success
                    Note over Orchestrator,API: All steps succeeded &lt;br&gt; Saga COMPLETED
                    Orchestrator-&gt;&gt;API: saga COMPLETED
                    API--&gt;&gt;Client: Order Success
                else Shipping Failure
                    Note over Orchestrator,Payment: Shipping failed &lt;br&gt; Start compensation
                    Orchestrator-&gt;&gt;Payment: compensate_payment()
                    Note right of Orchestrator: Compensate inventory
                    Orchestrator-&gt;&gt;Inventory: compensate_inventory()
                    Note right of Orchestrator: Compensate validation
                    Orchestrator-&gt;&gt;Validation: compensate_validation()
                    Orchestrator-&gt;&gt;API: saga FAILED
                    API--&gt;&gt;Client: Order Failed (Shipping)
                end
            else Payment Failure
                Note over Orchestrator,Inventory: Payment failed &lt;br&gt; Start compensation
                Orchestrator-&gt;&gt;Inventory: compensate_inventory()
                Note right of Orchestrator: Compensate validation
                Orchestrator-&gt;&gt;Validation: compensate_validation()
                Orchestrator-&gt;&gt;API: saga FAILED
                API--&gt;&gt;Client: Order Failed (Payment)
            end
        else Inventory Failure
            Note right of Orchestrator: Inventory reservation failed
            Note right of Orchestrator: Compensate validation
            Orchestrator-&gt;&gt;Validation: compensate_validation()
            Orchestrator-&gt;&gt;API: saga FAILED
            API--&gt;&gt;Client: Order Failed (Inventory)
        end
    else Validation Failure
        Note right of Orchestrator: Validation failed
        Orchestrator-&gt;&gt;API: saga FAILED
        API--&gt;&gt;Client: Order Failed (Validation)
    end</code></pre>
<h2 id="key-features-highlighted">Key Features Highlighted<a class="headerlink" href="#key-features-highlighted" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>Orchestrator-based Saga</strong>: Centralized coordination of transaction steps</li>
<li><strong>Automatic Compensation</strong>: Failed transactions trigger compensating actions</li>
<li><strong>Step-by-step Tracking</strong>: Detailed status tracking for each transaction step</li>
<li><strong>Fault Tolerance</strong>: Handles failures gracefully with automatic rollback</li>
<li><strong>REST API</strong>: Complete FastAPI implementation with comprehensive endpoints</li>
<li><strong>Mock Services</strong>: Simulated inventory, payment, and shipping services</li>
<li><strong>Comprehensive Logging</strong>: Detailed logging for debugging and monitoring</li>
</ul>
<p>These diagrams demonstrate how the Saga Pattern maintains data consistency across distributed services without using traditional ACID transactions, making it ideal for microservices architecture.</p>









  




                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["search.suggest", "search.highlight", "content.code.copy", "content.action.edit"], "search": "../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.50899def.min.js"></script>
      
    
  </body>
</html>